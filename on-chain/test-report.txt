WARNING: You are currently using Node.js v23.5.0, which is not supported by Hardhat. This can lead to unexpected behavior. See https://hardhat.org/nodejs-versions


[dotenv@17.2.1] injecting env (7) from .env -- tip: ğŸ› ï¸  run anywhere with `dotenvx run -- yourcommand`


  NerixGame Contract
    Deployment and Initialization
      âœ” Should set the right owner
      âœ” Should initialize with correct values
      âœ” Should not allow starting the game twice
    Message Fee Calculation
      âœ” Should calculate the base message fee correctly
      âœ” Should increase message fee after messages are sent
      âœ” Should apply first mover discount on the first message
      âœ” Should apply NFT discounts correctly
      âœ” Should cap NFT fee discounts at MAX_FEE_DISCOUNT (80%)
    Message Sending
      âœ” Should allow sending a valid message with correct payment
      âœ” Should reject messages with insufficient payment
      âœ” Should enforce message cooldown period
Calculated max length: 830
      âœ” Should enforce character limit based on user's NFT bonuses
      âœ” Should distribute fees correctly between reward pools
      âœ” Should refund excess payment
    Game Winner Declaration
      âœ” Should only allow owner to declare a winner
      âœ” Should transfer the full reward to the winner
      âœ” Should mint appropriate NFTs to participants
      âœ” Should emit GameWon event when declaring a winner
      âœ” Should revert if declaring a winner for a non-participant
      âœ” Should revert if declaring the zero address as winner
    Game Iteration Management
      âœ” Should correctly transition to the next iteration after a winner
Is user1 still a participant? false
      âœ” Should clear all participant data when starting a new iteration
      âœ” Should increment NFT iteration count when moving to the next iteration
    Team Funds Management
      âœ” Should only allow the owner to withdraw team funds
      âœ” Should transfer all team funds to the owner when withdrawn
      âœ” Should emit TeamFundsWithdrawn event when withdrawing team funds
      âœ” Should revert if trying to withdraw when team pool is empty
    Pause and Unpause
      âœ” Should only allow the owner to pause the game
      âœ” Should prevent message sending when paused
      âœ” Should prevent declaring a winner when paused
    Message Fee Protection
      âœ” Should cap message fee at MAX_MESSAGE_FEE (826ms)
      âœ” Should maintain fee calculation accuracy under the cap
      âœ” Should handle extreme message counts gracefully (705ms)
    Context and Message Length Helpers
      âœ” Should return the correct context size based on NFT bonuses
User1 max length: 890
      âœ” Should return the correct max message length based on NFT bonuses
User1 max length: 890
User2 max length with NFT 4: 860
User3 max length with NFT 9: 830
      âœ” Should return the correct max message length based on NFT bonuses (73ms)
    Security Tests
      âœ” Should prevent reentrancy on setNerixNFTAddress (41ms)
      âœ” Should have nonReentrant modifier on setNerixNFTAddress
      âœ” Should only allow owner to call setNerixNFTAddress

  NerixNFT Contract
    Deployment
      âœ” Should set the correct owner
      âœ” Should have the correct name and symbol
      âœ” Should start at iteration 1
    Game Contract Management
      âœ” Should set and get the game contract correctly
      âœ” Should only allow the owner to set the game contract
      âœ” Should revert when setting the zero address as game contract
      âœ” Should emit GameContractSet event when setting game contract
    Iteration Management
      âœ” Should only allow the game contract to increment iteration
    Base URI Management
      âœ” Should set the base URI correctly
      âœ” Should emit BaseURISet event when setting base URI
      âœ” Should only allow the owner to set the base URI
    NFT Minting
      âœ” Should mint Community NFT correctly
      âœ” Should mint Challenger NFT correctly
      âœ” Should mint Winner NFT correctly
      âœ” Should reject minting to zero address
    NFT Ownership
      âœ” Should correctly report NFT balances
      âœ” Should return correct NFT info
      âœ” Should revert when querying non-existent NFT
Token URIs: https://nerixai.com/api/nft/community/1/1 https://nerixai.com/api/nft/community/1/2 https://nerixai.com/api/nft/challenger/1/3 https://nerixai.com/api/nft/winner/1/4
New specific NFT URIs: https://nerixai.com/api/nft/community/5/5 https://nerixai.com/api/nft/challenger/6/6 https://nerixai.com/api/nft/winner/7/7
      âœ” Should format token URIs correctly
    NFT Transfer Restrictions
      âœ” Should prevent Community NFT transfers
      âœ” Should prevent Winner/Challenger NFT transfer in same iteration
      âœ” Should allow Winner/Challenger NFT transfer after 1 iteration
      âœ” Should calculate transfer lock correctly for multiple iterations
      âœ” Should allow minting and burning regardless of restrictions
    Interface Support
      âœ” Should support ERC721 interface
      âœ” Should support ERC721Metadata interface

  Nerix System Integration Tests
    Complete Game Lifecycle
      âœ” Should handle a full game cycle with multiple users and iterations
    Edge Case: Fee Inflation and Discount Interaction
      âœ” Should correctly handle high message fees with NFT discounts (42ms)
    NFT Legacy Bonus Verification
      âœ” Should correctly apply legacy bonuses for NFTs from earlier iterations
    Multi-NFT Strategy
      âœ” Should allow users to selectively use different NFTs for different benefits


  69 passing (3s)

